<!-- Fichier à créer : layouts/index.html -->
{{ partial "header.html" . }}
<main>
  <!-- Banner -->
  <img src="/img/dk1999f44027_doppel.jpg" alt="Banner image" style="width:100%;max-width:900px;display:block;margin:0 auto 2rem auto;">
  <div class="two-columns-container">    
    <!-- COLONNE 1 : Posts avec le tag "Z_news" -->
    <div class="content-column">
      <!-- <h2>News</h2> -->
      {{ $count := 0 }}
      {{ range where .Site.RegularPages "Params.tags" "intersect" (slice "news") }}
        {{ if lt $count 5 }}
        <article class="post-preview">
          <!-- <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3> -->
          
          <!-- Première image du post -->
          {{ with .Resources.GetMatch "*.{jpg,jpeg,png,gif,webp}" }}
            <img src="{{ .Permalink }}" alt="{{ $.Title }}" class="post-image">
          {{ else }}
            {{ with $.Params.image }}
              <img src="{{ . | relURL }}" alt="{{ $.Title }}" class="post-image">
            {{ end }}
          {{ end }}
          <!-- <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3> -->
          <!-- Extrait de texte (environ 3 lignes) -->
          <div class="post-excerpt">
            {{ .Summary | truncate 200 }}
          </div>
          
          <a href="{{ .Permalink }}" class="read-more">read '{{ .Title }}' →</a>
        </article>
        {{ $count = add $count 1 }}
        {{ end }}
      {{ end }}
    </div>
    
    <!-- COLONNE 2 : 5 last updated posts (ONLY posts with an update field) -->
<div class="images-column">

  {{ $withUpdate := where .Site.RegularPages "Params.update" "!=" nil }}
  {{ $sorted := sort $withUpdate "Params.update" "desc" }}

  {{ range first 5 $sorted }}
    <article class="post-preview">

      <!-- Image -->
      {{ with .Resources.GetMatch "*.{jpg,jpeg,png,gif,webp}" }}
        <img src="{{ .Permalink }}" alt="{{ $.Title }}" class="post-image">
      {{ else }}
        {{ with .Params.image }}
          <img src="{{ . | relURL }}" alt="{{ $.Title }}" class="post-image">
        {{ end }}
      {{ end }}

      <!-- Extrait -->
      <div class="post-excerpt">
        {{ .Summary | truncate 200 }}
      </div>

      <a href="{{ .Permalink }}" class="read-more">read '{{ .Title }}' →</a>

    </article>
  {{ end }}

</div>


    
  </div>
</main>
{{ partial "footer.html" . }}